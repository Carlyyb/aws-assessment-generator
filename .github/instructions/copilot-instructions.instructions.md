---
applyTo: "**"
---
# Project general coding standards
你是一名资深的React+TypeScript+AWS Serverless开发师。

仔细阅读以下要求，确保对要构建的内容没有任何理解偏差。  
回答需要全部用中文。  
在实现功能的时候直接实现并对接所需的其他功能。  
使用控制台命令时，使用PowerShell语法，并且不需要在本地部署，只需完成代码检查。  
不要修改 `API.ts`、`mutation.ts` 和 `query.ts` 文件，以上文件的修改都在 `lib\schema.graphql` 中声明。
resolver要使用Appsync Resolver支持的格式，可以仿照现有文件创建
lambda要使用Appsync Lambda支持的格式，可以仿照现有文件创建
---

### **CODING PROTOCOL（开发守则）：**

1. **开发要求**：
   - 严格用最少的代码完成当前任务。
   - 不进行大规模改动，专注于当前开发任务。
   - 开发完成后需考虑是否有相关功能和代码受到影响。
   - 代码必须精确、模块化、可测试，且不破坏现有功能。

2. **对 `PROJECT_FEATURES_DOCUMENTATION.md` 文件的使用要求**：
   - **查询功能**：在开发过程中，任何涉及到已实现功能的开发或修改时，先查询 `PROJECT_FEATURES_DOCUMENTATION.md` 文件，确保清楚哪些功能已经实现，哪些尚未完成。通过此文档了解每个功能的具体细节及其已知问题和限制。
   - **添加功能**：如果实现了新的功能或修改了现有功能，需要在文档中相应位置添加或更新该功能的描述。确保更新后的功能描述清晰、简洁，包含功能名称、描述、输入输出、依赖关系等关键信息。
   - **修改功能**：当已有功能有更改或修复时，需要在文档中更新相关的描述，确保文档与代码保持同步。如果某个功能的实现方式发生了变化，文档中的实现示例也需要随之修改。
   - **版本管理**：如果某个功能版本发生了变化，需要记录版本号和变动日志，确保功能的历史变更一目了然，避免重复开发。
   - **避免重复功能**：定期检查文档中已实现的功能列表，防止重复开发已实现的功能，尤其是在团队协作过程中。使用文档作为防止功能重复实现的参考。
   
   在文档更新时，请遵循以下格式：
   - **功能名称**：功能模块的名称。
   - **功能描述**：简要描述该功能的目的和实现思路。
   - **输入/输出**：明确该功能接收的输入和返回的输出。
   - **使用示例**：提供简单的代码示例或调用方式。
   - **依赖关系**：列出该功能依赖的其他模块或库。
   - **已知问题与限制**：描述该功能当前的已知问题。
   - **版本控制**：记录功能版本号和变动历史。
   - **未来扩展**：如果该功能有扩展计划或改进空间，简要提及。

3. **数据库字段修改完整流程**：
   当需要修改、添加或删除数据库字段时，必须按以下步骤执行：

   **步骤1：GraphQL Schema 更新**
   - 修改 `lib/schema.graphql` 文件中的相应 Type 和 Input 定义
   - 确保所有相关的 type、input、enum 都保持一致
   - 添加字段时考虑是否为可选字段（!标记）
   - 删除字段时检查是否有其他地方引用

   **步骤2：Resolver 更新**
   - 检查并更新相关的 AppSync Resolver 文件（`lib/resolvers/*.ts`）
   - 确保 resolver 处理新字段的映射和验证
   - 对于复杂逻辑，考虑是否需要在 Lambda 中处理

   **步骤3：Lambda 函数更新**
   - 更新相关的 Lambda 函数（`lib/lambdas/*.ts`）
   - 修改数据处理逻辑以支持新字段
   - 更新 DynamoDB 操作（如果涉及）
   - 添加必要的数据验证和转换

   **步骤4：前端 TypeScript 接口更新**
   - 更新前端接口定义，确保与 GraphQL schema 保持一致
   - 修改相关的 React 组件以支持新字段
   - 更新表单验证和数据展示逻辑

   **步骤5：GraphQL 查询/突变更新**
   - 更新 `ui/src/graphql/queries.ts` 和 `ui/src/graphql/mutations.ts`
   - 注意：不要直接修改这些文件，应该通过重新生成或 schema 变更来更新

   **步骤6：数据迁移考虑**
   - 对于已有数据，考虑是否需要数据迁移脚本
   - 确保向后兼容性，特别是可选字段的处理
   - 测试现有数据在新 schema 下的行为

   **步骤7：测试和验证**
   - 运行 `npm run build` 检查编译错误
   - 测试相关的 CRUD 操作
   - 验证前端界面正确显示和处理新字段
   - 检查权限控制是否正确应用

   **步骤8：文档更新**
   - 在 `PROJECT_FEATURES_DOCUMENTATION.md` 中记录字段变更
   - 更新功能描述和使用示例
   - 记录变更的原因和影响范围

   **常见字段修改场景示例**：
   ```
   场景1：添加可选字段
   - schema.graphql: 添加 `newField: String` 到相关 type
   - resolver: 处理字段映射（如果需要）
   - 前端: 更新接口和组件显示
   
   场景2：删除字段  
   - schema.graphql: 移除字段定义
   - resolver: 移除字段处理逻辑
   - lambda: 清理相关数据处理
   - 前端: 移除字段使用和显示
   
   场景3：字段重命名
   - 先添加新字段，保持旧字段
   - 数据迁移脚本（如果需要）
   - 逐步移除旧字段引用
   - 最后删除旧字段定义
   ```

4. **配置说明**：如果开发过程中需要任何配置（例如Supabase、AWS配置），请明确告知我。  

